<!-- [if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]--><!-- [if IE 7 ]><html class="ie ie7" lang="en"> <![endif]--><!-- [if IE 8 ]><html class="ie ie8" lang="en"> <![endif]--><!-- [if (gte IE 9)|!(IE)]><html lang="en"> <![endif]--><html><head><meta charset="utf-8"/><title>Profanity and Profundity - Kyle Shipley's Blog</title><meta name="description" content=""/><meta name="author" content="Kyle Shipley"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><link rel="stylesheet" href="/stylesheets/main.css"/><script src="/javascripts/prism.js" data-manual="data-manual"></script><script src="/javascripts/prism-ruby.js"></script><!-- [if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link rel="shortcut icon" href="/images/favicon.ico"/><link rel="apple-touch-icon" href="/images/apple-touch-icon.png"/><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"/></head><body><div class="container"><div class="four columns sidebar"><nav><h2 class="brand"><a href="/">Profanity & Profundity</a></h2><h5>Mostly the former</h5></nav><div class="info"><img src="/images/kyle.jpeg" class="avatar"/><div class="bio"><p>I'm <a href="https://twitter.com/kyleashipley">@kyleashipley</a>.</p><p>I <a href="https://github.com/shipstar">write code</a>, usually
in Ruby or JavaScript, and very infrequently words at this site.</p><p>You will find me at <a href="http://www.ourhealth.org">OurHealth</a>
these days as the Head of Product & Engineering. We are doing
Neat Stuffâ„¢ in healthcare and are
<a href="https://www.ourhealth.org/about-us/careers/#jobs">currently hiring</a>.</p></div></div></div><div class="eleven columns content post"><a href="/">< Home</a><br/><br/><div class="date">Aug 29, 2013</div><div class="length"><i class="icon-time"></i>5 min to read</div><h1>The 4-Player Raspberry Pi Arcade Cabinet</h1><p class="image">
  <img src="https://dl.dropbox.com/s/33r5xd8x5b6yzj8/cabinet.jpg" alt="cabinet">
</p>

<p>Back in college, I built a stand-up 4-player arcade cabinet that I egomaniacally dubbed &quot;The Shipstravaganza.&quot; It was one of the few major physical projects I&#39;ve undertaken, and I couldn&#39;t have accomplished it without help from a couple of friends. Inside the cabinet sat a Frankenstein PC I built from spare parts: an AMD Athlon 2900+ engineering chip I got from a friend and 512MB of RAM. It was slightly underpowered at the time, but it was <em>just</em> powerful enough to play older MAME ROMs, along with NES, SNES, Genesis, and more.</p>
<p>Fast forward to 2013. The machine was on its last legs. It originally ran Windows XP without a front-end &mdash; just ObjectDock and a mouse. I tried installing Lubuntu, but couldn&#39;t find a front-end I liked, and ran into some weird issues with <a href="http://www.anti-particle.com/wahcade.shtml">WahCade!</a> that I was having trouble debugging. I tried to reinstall XP, but the CD-ROM drive was broken, and you can&#39;t install XP from a USB stick.</p>
<p>I did a bit of research and stumbled across the <a href="http://blog.petrockblock.com/retropie/">RetroPie</a> project. Since I&#39;ve been wanting a Raspberry Pi since first hearing about it last summer, I decided to take the plunge and try it out. I ordered the $35 <a href="https://www.sparkfun.com/products/11546">Raspberry Pi Model B</a> from Sparkfun, installed <a href="http://www.raspberrypi.org/downloads">Raspbian via NOOBS</a>, and got started.</p>
<p>I decided to use the <a href="https://github.com/petrockblog/RetroPie-Setup">RetroPie-Setup</a> script just to minimize my investment on the software side, given my previous issues with XP and Lubuntu. The instructions were dead simple &mdash; just make sure you&#39;ve bumped your memory split per the instructions before you start installing. I decided to compile the emulator binaries from source. Be warned: if you decide to compile ALL THE EMULATORS!, it will take nearly an entire day. I&#39;d recommend pruning down if you don&#39;t plan to use some of the more obscure emulators like Apple IIc, PCx86, and Amiga.</p>
<p>Once the compilation was done, I uploaded a few ROMs just to test everything out. I had a bit of slowdown in MAME and the SNES emulator, so I decided to use the Raspberry Pi&#39;s software overclocking capabilities to speed things up. I bumped up one level to 800MHz. My performance has been pretty good since then, but YMMV!</p>
<p>The next step for me was to configure the joystick from my arcade cabinet. My original build used an <a href="http://www.ultimarc.com/ipac1.html">I-PAC4</a> from Ultimarc, which is a keyboard encoder that lets you map arcade buttons to keyboard inputs. Here&#39;s a picture:</p>
<p class="image">
  <img src="https://dl.dropbox.com/s/08ssvzoagmu3xhe/ipac4.jpg" alt="I-PAC4">
</p>

<p>(<strong>Side note</strong>: I had no soldering skills at the time I completed this project, so I hand-rolled, crimped, and daisy chained wires together for 33 buttons and 4 joysticks. My fingers had blisters for days. I wouldn&#39;t recommend it to anyone else, but I&#39;m glad I did it!)</p>
<p>My I-PAC4 has an old-school PS/2 connector, so I needed to buy a PS/2-to-USB adapter, which worked out of the box. The main emulation engine in RetroPie is RetroArch + libretro. The default configuration for the iPac4 has a few mysterious button choices that RetroArch doesn&#39;t support, so I had to download the <a href="http://www.ultimarc.com/download.html">WinIPAC Interactive Panel Designer</a> to update my configuration. (The OSX implementation is hopelessly out of date and only runs on PowerPC. I didn&#39;t try the Linux utility because I had a Windows machine available and had used the Windows version before.)</p>
<p>I tried editing the retroarch.cfg file in ~/RetroPie/configs/all, but it wasn&#39;t working for me, so I edited /etc/retroarch.cfg directly. When programming the I-PAC, I made sure to bind keys that are available to RetroArch. <a href="https://github.com/libretro/RetroArch/blob/e911eda7f41a9e0750ddf01880827b6e8ac1bfc4/input/input_common.c#L616">This file</a> has all of the available mappings. One other curiosity &mdash; there are key assignments that are commented out in retroarch.cfg, but they are actually in effect. An example:</p>
<pre><code># input_menu_toggle = f1
</code></pre><p>I originally assigned my P1 Start button to F1, and it took me a few minutes to realize that it was being overridden in the retroarch.cfg. Make sure you uncomment these lines and set the values to nul if you plan to use any of those keys in your I-PAC mapping:</p>
<pre><code># not a typo!
input_menu_toggle = nul
</code></pre><p>At this point, all the games were playable with my joystick. I only had one task left before declaring success: hooking up a physical power button. My Raspberry Pi sits inside a sealed cabinet with no keyboard attached. I did install a Wifi module from <a href="http://www.adafruit.com/products/814">Adafruit</a> using the instructions <a href="http://learn.adafruit.com/adafruits-raspberry-pi-lesson-3-network-setup/setting-up-wifi-with-occidentalis">here</a> and enabled the ssh agent in raspi-config, so I could&#39;ve ssh&#39;ed into the Raspberry Pi to shut it down each time, but this seemed inconvenient.</p>
<p>In my original build, I cut the wires from my PC&#39;s power button to the motherboard and wired them up to the arcade button in my joystick. The Raspberry Pi doesn&#39;t have a power button, but it does have some exposed GPIO pins we can use. Luckily, one of the GPIO pins has a pullup resistor built-in, so I didn&#39;t even need to breadboard/solder a circuit. I used <a href="http://www.raspberrypi.org/phpBB3/viewtopic.php?f=37&amp;t=42449">these instructions</a> and a slightly modified version of <a href="https://github.com/g0to/misc_scripts/blob/master/raspi_gpio_actions_INT.py">this script</a> to set up my power button. I bought a PC power jumper, cut it, rolled the wires together, and used some shrink tubing to make it work. All told, it took about 5-10 minutes of actual effort.</p>
<p>One downside to the GPIO pins is that you can&#39;t read them via software when the machine is powered off. (Duh.) Luckily, the setup I went with fits my situation, so I didn&#39;t need to worry about it. My arcade cabinet has a power strip inside and a hole in the back. When I want to play a game, I plug in the power strip, which automatically powers on the Raspberry Pi. I play, then press the power button when I&#39;m ready to shut down. Once the Raspberry Pi finishes the shutdown procedure, I unplug the cabinet, and I&#39;m ready for the next time.</p>
<p>If you&#39;re thinking about putting a MAME cabinet together, I&#39;d highly recommend considering the Raspberry Pi. It&#39;s not powerful enough to run some more modern arcade games and I haven&#39;t bothered with added complexities like <a href="http://en.wikipedia.org/wiki/MAME#Game_data">CHDs</a> (not to be confused with <a href="http://en.wikipedia.org/wiki/C.H.U.D.">CHUDs</a>). But overall, it was fairly easy to set up and it seems to be a popular target for emulation right now.</p>
<p>Here&#39;s the old ~$500 machine I replaced with a tiny little $35 Raspberry Pi:</p>
<p class="image">
  <img src="https://dl.dropbox.com/s/qvbmlqckimwtg85/old_pc.jpg" alt="Old PC">
</p>

<p>I love technology.</p>
<p>If you have any questions about my setup or the issues I ran into, feel free to contact me on <a href="https://twitter.com/kyleashipley">Twitter</a>. Thanks for reading!</p></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43659103-1', 'kyleshipley.com');
ga('send', 'pageview');
</script><script>// Possibly hyper-aggressive Ruby highlighting.
var codeBlocks = document.getElementsByTagName("code");
for (var i = 0; i < codeBlocks.length; i++) {
  var block = codeBlocks[i];
  if (block.textContent.match(/def\b|\.rb|@\w*\b|\(main\)|\bend\b|[A-Z]\w*\.new/)) {
    block.className += "language-ruby";
  }
};
Prism.highlightAll();</script></body></html>